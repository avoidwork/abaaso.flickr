/**
 * abaaso.flickr
 *
 * @author Jason Mulligan <jason.mulligan@avoidwork.com>
 * @copyright 2012 Jason Mulligan
 * @license BSD-3 <https://github.com/avoidwork/abaaso.flickr/blob/master/LICENSE>
 * @link https://github.com/avoidwork/abaaso.flickr
 * @module abaaso.flickr
 * @version 1.4.0
 */
(function(e){"use strict";flickr=function(e){var t=this;t.id=null,t.key=null,t.loaded=null,t.photo=null,t.sets=[],t.timer=null,t.timeout=15e3,$.merge(t,e)},flickr.prototype.init=function(e){if(this.id===null||this.key===null)throw Error($.label.error.invalidArguments);var n=this,r=e||(n.sets.length>1?$.random(n.sets.length):0),i=$.promise(),s=t.set.replace("{{KEY}}",this.key).replace("{{ID}}",this.sets[r]);$.observer.discard(!0),i.then(function(e){return n.data[n.loaded]=e.photo,$.observer.discard(!1),e.photo.each(function(e){n.load(e)}),e},function(e){return $.observer.discard(!1),$.error(e),e}),this.loaded=this.sets[r],$.store(this,null,{key:"id",source:"photoset",ignore:"sizes"}),this.data.setUri(s,i)},flickr.prototype.load=function(e){if(typeof e=="undefined"||typeof e.key=="undefined")return;var n=this,r=t.sizes.replace("{{KEY}}",this.key).replace("{{ID}}",e.key),i=this.data.keys[e.key].index,s,o,u;return s=function(e){o=n.data.get(i),o.data.sizes=e.sizes.size.clone(),n.fire("flickrImage",o)},typeof e.data.sizes=="undefined"&&r.jsonp(s,function(){$.fire("error")},"jsoncallback"),e};var t={set:"http://api.flickr.com/services/rest/?&method=flickr.photosets.getPhotos&api_key={{KEY}}&photoset_id={{ID}}&format=json&jsoncallback=?",sizes:"http://api.flickr.com/services/rest/?&method=flickr.photos.getSizes&api_key={{KEY}}&photo_id={{ID}}&format=json&jsoncallback=?"};init=function(t){return $=e[t.aliased],t.module("flickr",flickr)},typeof define=="function"?define(["abaaso"],function(e){return init(e)}):abaaso.on("init",function(){return init(abaaso)},"abaaso.flickr")})(this);